{
  "hash": "29dfd4ba5f88150f84bbd441aa27e911",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Exploratory Data Analysis\"\n---\n\n\n\n\n# Setting up {.unnumbered}\n\n## Loading packages {.unnumbered}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Check our my packages\"}\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(ggalluvial)\n```\n:::\n\n\n\n\n## Loading functions {.unnumbered}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Check our my functions\"}\ncount_transitions <- function(data, years, absorbing = FALSE) {\n  # Counts the occurrences of cognitive status transitions across specified \n  # years.\n  # Converts numeric cognitive status codes (1, 2, 3) into descriptive labels\n  # (\"Normal Cognition\", \"MCI\", \"Dementia\") and handles missing or unexpected values.\n  # Aggregates the data to count transitions and reshapes it into a long format for analysis.\n  # Arguments:\n  #    - data: The input dataset containing cognitive function data.\n  #    - years: A vector of years for which transitions should be counted.\n  # Returns:\n  #   - A dataset with counts of cognitive status transitions, including\n  #   \"Missing\" and \"Other\" categories.\n  \n  # Create dynamic column names based on the years provided\n  cogfunction_cols <- paste0(\"cogfunction\", years)\n  \n  data <- data |>\n    select(ID, all_of(cogfunction_cols)) |>\n    na.omit() |>\n    tidyr::pivot_longer(\n      cols = !ID,\n      names_to = \"Wave\",\n      values_to = \"Classification\"\n    ) |>\n    mutate(\n      Wave = stringr::str_replace(Wave, \"cogfunction\", \"HRS \"),\n      Wave = factor(Wave, levels = c(paste0(\"HRS \", years))),\n      \n      Classification = case_when(\n        Classification == 1 ~ \"Normal Cognition\",\n        Classification == 2 ~ \"MCI\",\n        Classification == 3 ~ \"Dementia\")\n    )\n  \n  if(absorbing == TRUE){\n    data <- data |>\n      group_by(ID) |>\n      mutate(\n        Classification = ifelse(\n          cumany(Classification == \"Dementia\"), \"Dementia\", Classification)) |>\n      ungroup()\n  }\n  \n  data <- data |>\n    mutate(Classification = factor(\n      Classification,\n      levels = c(\"Normal Cognition\", \"MCI\", \"Dementia\")))\n  \n  return(data)\n}\n\nplot_cognitive_scores <- function(data, year) {\n  # Plots the distribution of cognitive scores over a range of years.\n  # Converts the data from wide to long format and generates histograms for each wave.\n  # Arguments:\n  #   - data: The dataset containing cognitive scores.\n  #   - year: The starting year for the range of cognitive scores to plot.\n  # Returns:\n  #   - A ggplot object showing the distribution of cognitive scores across waves.\n  # Plotting dementia transitions\n  data |>\n    select(ID, any_of(paste0(\"cogtot27_imp\", year:2022))) |>\n    na.omit() |>\n    tidyr::pivot_longer(cols = !ID,\n                        names_to = \"Wave\",\n                        values_to = \"Score\") |>\n    mutate(Wave = as.double(stringr::str_replace(Wave, \"cogtot27_imp\", \"\"))) |>\n    ggplot(aes(x = Score)) +\n    geom_histogram(fill = \"#56B4E9\",\n                   colour = \"black\",\n                   alpha = 0.5) +\n    scale_x_continuous(breaks = seq(0, 27, by = 3)) +\n    labs(\n      title = paste0(\"Distribution of cognitive scores \", year, \"- 2022\"),\n      x = \"Cognitive Score\", y = \"\") +\n    facet_wrap( ~ Wave)\n}\n\nplot_transitions <- function(data, size) {\n  # Visualizes cognitive status transitions over time using an alluvial plot.\n  # Represents the flow of individuals between cognitive states across waves.\n  # Arguments:\n  #   - data: The dataset containing transition data.\n  #   - size: The font size for labels in the plot.\n  # Returns:\n  #   - A ggplot object showing transitions between cognitive states over time.\n  \n  require(ggalluvial)\n  \n  data |>\n    ggplot(aes(x = Wave, y = n, stratum = Classification, \n               fill = Classification, alluvium = ID\n    )) +\n    geom_stratum(alpha = 0.5, width = 0.5) +\n    geom_flow(width = 0.5) +\n    geom_text(\n      stat = \"stratum\",\n      aes(label = stringr::str_wrap(Classification, width = 10)),\n      hjust = 0.5,\n      vjust = 0.5,\n      size = size\n    ) +\n    labs(title = \"Dementia transitions across time\", \n         x = \"\", y = \"Frequency\") +\n    scale_fill_viridis_d(direction = -1) +\n    theme(axis.text = element_text(size = 10), \n          text = element_text(size = 10)) +\n    ggeasy::easy_remove_legend()\n}\n```\n:::\n\n\n\n\n## Setting theme {.unnumbered}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Check our my theme\"}\ncolour = \"#212427\"\n\ntheme_set(\ntheme_minimal() +\n  theme(\n    panel.grid = element_blank(),\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\", colour = colour),\n    plot.subtitle = element_text(hjust = 0.5, size = 10, colour = colour),\n    axis.title = element_text(size = 10, face = \"bold\", colour = colour),\n    strip.text = element_text(size = 10, face = \"bold\", colour = colour)\n    ))\n```\n:::\n\n\n\n\n\n## Reading in data {.unnumbered}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- read.csv(here::here(\"analysis/data/data.csv\")) \n```\n:::\n\n\n\n\n# Dementia Dataset\n\nOur updated dataset contains 13 columns of cognitive classifications spanning from 1996 to 2022. These columns reflect dementia status across each wave, using the same criteria and structure as the original Langa-Weir dataset, now extended to include the most recent 2022 wave.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndementia_data <- data |>\n  count_transitions(years = seq(1996, 2022, by = 2))\n\nglimpse(dementia_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 2,296\nColumns: 3\n$ ID             <int> 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3…\n$ Wave           <fct> HRS 1996, HRS 1998, HRS 2000, HRS 2002, HRS 2004, HRS 2…\n$ Classification <fct> Normal Cognition, Normal Cognition, Normal Cognition, N…\n```\n\n\n:::\n:::\n\n\n\n\n\n## Missing data\n\nSince the participant pool is drawn from the 2020 wave of the HRS data, any analysis that looks back at previous waves will inevitably encounter missing data. Not all participants were included in earlier waves, leading to gaps in the data. @fig-missing-data displays the frequency of missing cognitive test data across each HRS wave.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Dynamic colours\ncolours <- c(rep(\"#2e2e2e\", times = 12), \"red\", \"#2e2e2e\")\n\ndata |>\n  select(any_of(paste0(\"cogtot27_imp\", 1996:2022))) |>\n  rename_with( ~ stringr::str_replace(., \"cogtot27_imp\", \"\"), starts_with(\"cogtot27\")) |>\n  visdat::vis_dat() +\n  labs(title = \"Missing data across HRS Waves (1996 - 2022)\",\n       subtitle = \"Total Cognitive Scores\") +\n  theme(\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\", colour = colour),\n    plot.subtitle = element_text(hjust = 0.5, size = 12, face = \"bold\", colour = colour),\n    panel.grid = element_blank(),\n    axis.text.x = element_text(colour = colours)) +\n  ggeasy::easy_remove_legend() +\n  ggeasy::easy_x_axis_labels_size(size = 9)\n```\n\n::: {.cell-output-display}\n![Occurance of missing data across HRS waves (participants were gathered from the 2020 HRS wave [in red])](data-exploration_files/figure-html/fig-missing-data-1.png){#fig-missing-data width=768}\n:::\n:::\n\n\n\n\nThe HRS had its most recent participant intake in 2016, which explains the notable decline in missing data occurrences from that point onward. As new participants were not added after 2016, the dataset becomes more complete in subsequent waves, with fewer missing values. \n\nGiven this shift, we will conduct our analysis **the reduced dataset (2016 - 2022)** (@fig-complete-data) along with removing the missing values from 2016 and 2018.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata |>\n  select(any_of(paste0(\"cogtot27_imp\", 2016:2022))) |>\n  rename_with( ~ stringr::str_replace(., \"cogtot27_imp\", \"\"), starts_with(\"cogtot27\")) |>\n  na.omit() |>\n  visdat::vis_dat() +\n  labs(\n    title = \"Complete dataset across HRS Waves (2016 - 2022)\",\n    subtitle = \"Total Cognitive Scores\") +\n    theme(\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\", colour = colour),\n    plot.subtitle = element_text(hjust = 0.5, size = 12, face = \"bold\", colour = colour),\n    panel.grid = element_blank()) +\n  ggeasy::easy_remove_legend() +\n  ggeasy::easy_x_axis_labels_size(size = 9)\n```\n\n::: {.cell-output-display}\n![HRS dataset after processing](data-exploration_files/figure-html/fig-complete-data-1.png){#fig-complete-data width=768}\n:::\n:::\n\n\n\n\n\n## Exploratory Data Analysis\n\n### Cognitive Test Scores\n\nInitially, we will plot a distribution of the cognitive test scores (ranging from 0 - 27) across time for all HRS participants.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_cognitive_scores(data = data, year = 2016)\n```\n\n::: {.cell-output-display}\n![Cognitive test scores (2016 - 2022)](data-exploration_files/figure-html/fig-cognitive-test-scores-1.png){#fig-cognitive-test-scores width=1152}\n:::\n:::\n\n\n\n\n### Classification proportion per year\n\n@fig-dementia-proportions shows the proportion of dementia classifications from HRS 2016 - 2022. The variable **Missing** represents the procrastination HRS respondents who were not yet interviewed by the HRS. Since the analysis focuses on participants included in the 2020 HRS wave, any retroactive analysis of prior waves may result in missing data for certain individuals\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plotting proportions --------------------------------------------------------\ndata |>\n  count_transitions(years = seq(2016, 2022, by = 2), absorbing = TRUE) |>\n  ggplot(aes(x = Wave, fill = Classification)) +\n  geom_bar(position = \"fill\", alpha = 0.5, colour = \"black\") +\n  scale_y_continuous(labels = scales::percent) +\n  labs(title = \"Proportion of Cognitive Status Classifications (2016 - 2022)\", \n       x = \"\", y = \"Percentage\") +\n  scale_fill_viridis_d(direction = -1) +\n  theme(\n    axis.text = element_text(size = 10),\n    text = element_text(size = 10)) +\n  ggeasy::easy_move_legend(\"bottom\") +\n  ggeasy::easy_remove_legend_title()\n```\n\n::: {.cell-output-display}\n![Proportion of dementia classifications per year](data-exploration_files/figure-html/fig-dementia-proportions-1.png){#fig-dementia-proportions width=1152}\n:::\n:::\n\n\n\n\n### Dementia transitions per year\n\n@fig-dementia-transitions is an alluvial graph illustrating the transitions in cognitive classifications from one HRS wave to the next.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata |>\n  count_transitions(years = seq(2016, 2022, by = 2)) |>\n  group_by(ID, Wave) |>\n  reframe(plyr::count(Classification)) |>\n  rename(Classification = x, n = freq) |>\n  plot_transitions(size = 2.5)\n```\n\n::: {.cell-output-display}\n![Dementia transitions (2016 - 2022)](data-exploration_files/figure-html/fig-dementia-transitions-1.png){#fig-dementia-transitions width=1152}\n:::\n:::\n\n\n\n\nFrom this figure we can see that some individuals classified with dementia in one wave transition out of dementia in a subsequent wave. Let's fix this by adding an additional parameter to our `count_transitions()` function to turn dementia into an absorbing state (@fig-dementia-transitions-absorbing). We can do this by using the `cumany()` function from the `dplyr` [@Wickham2023] package.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata |>\n  count_transitions(years = seq(2016, 2022, by = 2), absorbing = TRUE) |>\n  group_by(ID, Wave) |>\n  reframe(plyr::count(Classification)) |>\n  rename(Classification = x, n = freq) |>\n  plot_transitions(size = 2.5)\n```\n\n::: {.cell-output-display}\n![Dementia transitions with dementia as an absorbing state (2016 - 2022)](data-exploration_files/figure-html/fig-dementia-transitions-absorbing-1.png){#fig-dementia-transitions-absorbing width=1152}\n:::\n:::\n",
    "supporting": [
      "data-exploration_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}